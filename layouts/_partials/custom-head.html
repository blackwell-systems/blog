<!-- Custom CSS -->
<link rel="stylesheet" href="{{ "css/custom.css" | absURL }}">

<!-- Mermaid diagram support -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      darkMode: true,
      background: '#252627',
      primaryColor: '#80AADD',
      primaryTextColor: '#f8f8ff',
      primaryBorderColor: '#4a5568',
      lineColor: '#80AADD',
      secondaryColor: '#2c5282',
      tertiaryColor: '#1a365d'
    }
  });

  // Add click-to-expand functionality after mermaid renders
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
      const mermaidDivs = document.querySelectorAll('.mermaid');
      console.log('Found mermaid divs:', mermaidDivs.length);

      mermaidDivs.forEach(div => {
        div.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Mermaid clicked');
          // Create modal
          const modal = document.createElement('div');
          modal.className = 'mermaid-modal active';

          // Prevent body scroll when modal is open
          document.body.style.overflow = 'hidden';

          // Create close button
          const closeBtn = document.createElement('span');
          closeBtn.className = 'mermaid-modal-close';
          closeBtn.innerHTML = '&times;';

          // Clone the SVG
          const svg = this.querySelector('svg');
          if (!svg) {
            console.error('No SVG found in mermaid div');
            return;
          }
          console.log('SVG found, creating modal');

          const modalContent = document.createElement('div');
          modalContent.className = 'mermaid-modal-content';
          modalContent.appendChild(svg.cloneNode(true));

          modal.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          console.log('Modal appended to body');

          // Close on click
          const closeModal = () => {
            document.body.style.overflow = '';
            modal.remove();
          };

          closeBtn.addEventListener('click', closeModal);
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              closeModal();
            }
          });

          // Close on Escape key
          document.addEventListener('keydown', function escapeHandler(e) {
            if (e.key === 'Escape') {
              closeModal();
              document.removeEventListener('keydown', escapeHandler);
            }
          });
        });
      });
    }, 1000); // Wait for mermaid to finish rendering
  });
</script>
