<!-- Custom CSS -->
<link rel="stylesheet" href="{{ "css/custom.css" | absURL }}">

<!-- Mermaid diagram support -->
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    startOnLoad: true,
    theme: 'dark',
    themeVariables: {
      darkMode: true,
      background: '#252627',
      mainBkg: '#252627',
      primaryColor: '#4a5568',
      primaryTextColor: '#f0f0f0',
      primaryBorderColor: '#4a5568',
      lineColor: '#6b7280',
      secondaryColor: '#374151',
      tertiaryColor: '#1f2937',
      // Text colors
      textColor: '#f0f0f0',
      labelTextColor: '#f0f0f0',
      nodeTextColor: '#f0f0f0',
      // Additional colors for various diagram types
      noteBkgColor: '#374151',
      noteTextColor: '#f0f0f0',
      noteBorderColor: '#6b7280',
      actorBkg: '#374151',
      actorBorder: '#6b7280',
      actorTextColor: '#f0f0f0',
      signalColor: '#6b7280',
      signalTextColor: '#f0f0f0',
      labelBoxBkgColor: '#374151',
      labelBoxBorderColor: '#6b7280',
      loopTextColor: '#f0f0f0',
      activationBorderColor: '#6b7280',
      activationBkgColor: '#1f2937',
      sequenceNumberColor: '#252627',
      // Flowchart
      clusterBkg: '#1f2937',
      clusterBorder: '#6b7280',
      defaultLinkColor: '#6b7280',
      edgeLabelBackground: '#252627',
      // Timeline
      cScale0: '#3A4A5C',
      cScale1: '#3A4C43',
      cScale2: '#4C4538',
      cScale3: '#4C3A3C',
      cScale4: '#374151',
      cScale5: '#1f2937',
      cScale6: '#3A4A5C',
      cScale7: '#3A4C43',
      cScale8: '#4C4538',
      cScale9: '#4C3A3C',
      cScale10: '#374151',
      cScale11: '#1f2937'
    }
  });

  // Add click-to-expand functionality after mermaid renders
  document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
      const mermaidDivs = document.querySelectorAll('.mermaid');
      console.log('Found mermaid divs:', mermaidDivs.length);

      mermaidDivs.forEach(div => {
        div.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          console.log('Mermaid clicked');
          // Create modal
          const modal = document.createElement('div');
          modal.className = 'mermaid-modal active';

          // Prevent body scroll when modal is open
          document.body.style.overflow = 'hidden';

          // Create close button
          const closeBtn = document.createElement('span');
          closeBtn.className = 'mermaid-modal-close';
          closeBtn.innerHTML = '&times;';

          // Clone the SVG
          const svg = this.querySelector('svg');
          if (!svg) {
            console.error('No SVG found in mermaid div');
            return;
          }
          console.log('SVG found, creating modal');

          const modalContent = document.createElement('div');
          modalContent.className = 'mermaid-modal-content';
          modalContent.appendChild(svg.cloneNode(true));

          modal.appendChild(closeBtn);
          modal.appendChild(modalContent);
          document.body.appendChild(modal);
          console.log('Modal appended to body');

          // Close on click
          const closeModal = () => {
            document.body.style.overflow = '';
            modal.remove();
          };

          closeBtn.addEventListener('click', closeModal);
          modal.addEventListener('click', function(e) {
            if (e.target === modal) {
              closeModal();
            }
          });

          // Close on Escape key
          document.addEventListener('keydown', function escapeHandler(e) {
            if (e.key === 'Escape') {
              closeModal();
              document.removeEventListener('keydown', escapeHandler);
            }
          });
        });
      });
    }, 1000); // Wait for mermaid to finish rendering
  });
</script>

<!-- GoatCounter Analytics -->
<script data-goatcounter="https://blackwell-systems.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>
